js test note

åƒè€ƒé€£çµï¼šhttps://wcc723.github.io/development/2020/02/02/jest-intro/
é¦–å…ˆé€²åˆ°è³‡æ–™å¤¾ï¼Œç„¶å¾Œåšnpm init
    command line:
        npm init -y

æ¥è‘—æœƒç™¼ç¾å› ç‚ºä½ initç¾åœ¨çš„å°ˆæ¡ˆäº†æ‰€ä»¥ä»–æœƒç”¢ç”Ÿä¸€å€‹package.jsonçš„æª”æ¡ˆæˆ‘å€‘ç­‰ä¸‹æœƒç”¨é€™å€‹æª”æ¡ˆå»è·‘script

å®‰è£jest
    command line:
        npm i --save-dev jest

æœƒçœ‹åˆ°ç†Ÿæ‚‰çš„node_modulesæª”æ¡ˆï¼Œä¹Ÿæœƒç”¢ç”Ÿpackage-lock.json
é€™æ¨£å°±å·²ç¶“åšå¥½package versionæ§åˆ¶äº†
åŸæœ¬çš„package.jsonçš„codeæ˜¯é•·é€™æ¨£
code:
{
  "name": "jstest",
  "version": "1.0.0",
  "description": "",
  "main": "cloneArray.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {},
  "devDependencies": {
    "jest": "^24.9.0"
  }
}

ç¾åœ¨æˆ‘å€‘è¦æŠŠå®ƒæ”¹ä¸€ä¸‹
code:
{
  "name": "jstest",
  "version": "1.0.0",
  "description": "",
  "main": "cloneArray.js",
  "scripts": {
    "test": "jest"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {},
  "devDependencies": {
    "jest": "^24.9.0"
  }
}

é€™æ¨£å°±å¯ä»¥è·‘æ¸¬è©¦äº†ï¼Œæ¥è‘—è·‘ç¬¬ä¸€æ¬¡æˆ‘å€‘çœ‹ä¸€ä¸‹

æ¥è‘—å¦‚æœæˆ‘å€‘è¦è·‘ä»€éº¼çš„æ¸¬è©¦çš„è©±
æˆ‘å€‘å°±æŠŠé»¨åå‘½åç‚ºï¼šæª”å.test.jsé€™æ¨£å°±å¯ä»¥äº†
é€™è£¡æœƒæœ‰å…©æ®µ
ä¸€æ®µæ˜¯å°ä¸€ç­çš„æ¸¬è©¦æˆ‘å€‘å…ˆçœ‹ä¸€ä¸‹
é¦–å…ˆæˆ‘å€‘å…ˆè¦‹sum.test.js
code:
const sum = require('./sum');

test('properly adds two numbers', () => {
    expect(
        sum(1, 2)
    ).toBe(3);
});

æ‰“å®Œä»¥å¾Œå†æ‰“ä¸€æ¬¡npm testæ¥è‘—ä»–å°±æœƒå»è·‘æ¸¬è©¦äº†
æˆ‘å€‘æœƒçœ‹åˆ°passedå­—æ¨£å°±ä»£è¡¨æˆ‘å€‘å·²ç¶“æ¸¬å®Œäº†


å¾Œé¢æˆ‘å€‘ä¾†å»ºç«‹æˆ‘å€‘çš„cloneArray.jsçš„æ¸¬è©¦
ä¸€æ¨£å»ºç«‹cloneArray.test.jsæª”æ¡ˆ
code:
const cloneArray = require('./cloneArray');

test('properly clones array', () => {
    const array = [1, 2, 3];
    expect(
        cloneArray(array)
    ).toBe(
        array
    );
});
é€™å€‹æ™‚å€™ä»–æœƒå ±éŒ¯ï¼Œèªªæˆ‘å€‘ç”¨ä¾†æ¯”å°çš„æ–¹æ³•éŒ¯èª¤å› ç‚ºä»–æ˜¯array
æˆ‘å€‘è¦æ›ä¸€å€‹æ–¹æ³•æ‰€ä»¥æˆ‘å€‘èª¿ä¸€ä¸‹code:
const cloneArray = require('./cloneArray');

test('properly clones array', () => {
    const array = [1, 2, 3];
    expect(
        cloneArray(array)
    ).toStrictEqual(
        array
    );
});

é€™è£¡çš„test caseå®ƒæä¾›äº†å¦ä¸€ç¨®æ±è¥¿
code:
expect(cloneArray(array)).toEqual(array);
expect(cloneArray(array)).not.toBe(array);
æ„Ÿè¦ºé€™æ¨£çš„å¯«æ³•æ˜¯å› ç‚ºç•¶åˆåœ¨å¼„æ¸¬è©¦æ™‚å€™æ²’æœ‰è€ƒæ…®åˆ°æ€éº¼è™•ç†arrayæ‰€ä»¥ç¡¬æ“ çš„åšæ³•

é€™æ¨£çš„æ„æ€æ˜¯æˆ‘å€‘è¦æ¯”è¼ƒåš´æ ¼çš„å»æ¯”å°ä¸€å®šè¦ä¸€æ¨£åƒæ˜¯å‹åˆ¥æˆ–è€…æ ¼å¼ç­‰ç­‰çš„
ä½†æ˜¯å°è±¡ä¸­æ²’è¾¦æ³•å»åšæ¯”å°çš„æ‡‰è©²æ˜¯object

å¦‚æœåªæ˜¯æƒ³çŸ¥é“æœ‰æ²’æœ‰æ¸¬éçš„è©±package.jsonåªè¦å¯«testçš„å‘½ä»¤å°±å¥½å¦‚æœè¦çŸ¥é“coverageçš„è©±å°±è¦åœ¨commandä¸ŠåŠ å·¥äº†
code:
"test": "jest --coverage"
é€™æ¨£å°±å¯ä»¥çœ‹åˆ°å®Œæ•´çš„coverageäº†
ç¾åœ¨çœ‹èµ·ä¾†æ‡‰è©²æœƒæ˜¯100%çš„ç‹€æ…‹

æˆ‘å€‘å›åˆ°æˆ‘å€‘çš„sum.jsè£¡é¢æˆ‘å€‘åŠ ä¸Šä¸€æ”¯æ–°çš„function
code:
function sum(a, b) {
    return a + b;
};

function helper() {
    console.log('helper');
}

module.exports = sum;
å†è·‘ä¸€æ¬¡npm testæ¥ä¸‹ä¾†ä½ æœƒåˆ°æˆ‘å€‘çš„coverageè®Šæˆ66.67
é»é–‹æ¸¬è©¦å ±å‘Šé‚„å¯ä»¥çœ‹åˆ°åˆ°åº•æ˜¯å“ªéš»æª”æ¡ˆçš„è¦†è“‹ç‡å¤ªä½
ç„¶å¾Œå¯ä»¥åœ¨è‡ªå·±æ¨¡æ“¬å¦‚æœæ”¹äº†codeä»¥å¾Œæ¸¬è©¦å ±å‘Šæœƒé•·æ€æ¨£
ç„¶å¾Œç¾åœ¨åšçš„æ˜¯å–®å…ƒæ¸¬è©¦å°±æ˜¯æŠŠæ±è¥¿æ‹†çš„å°å°çš„é€™æ¨£æ¸¬


åƒè€ƒé€£çµï¼šhttps://ithelp.ithome.com.tw/articles/10238581

1.
åœ¨ /js/ è£é¢å»ºä¸€éš»æ–°çš„æª”æ¡ˆ calculation_og.js
ç„¶å¾ŒæŠŠ code æ”¾ä¸Šå»
`
  const sum = (a, b) => a - b // æœ‰ bug

  const result = sum(8, 7)

  const expected = 15
  if (result !== expected) {
    throw new Error(`${result} is not equal to ${expected}`)
  }
`

ä½¿ç”¨ node å»è®€å®ƒ
folder:     cd /Users/terry.yao/project/jest
command:    node js/calculation_og.js
result:     
  /Users/terry.yao/project/jest/js/calculation.js:7
        throw new Error(`${result} is not equal to ${expected}`)
        ^

  Error: 1 is not equal to 15
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/calculation.js:7:8)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47

é€™æ¨£å°±å®Œæˆæœ€åŸºæœ¬çš„æ¸¬è©¦ç‹€æ…‹äº†

æŠŠæœ¬ä¾†çš„ calculation_og.js è¤‡è£½ä¸€ä¸‹æ”¹å calculation_fix.js
ç„¶å¾ŒæŠŠ code æ”¹æˆä¸‹é¢é€™æ¨£
`
  const sum = (a, b) => a + b
  const subtract = (a, b) => a - b

  let result = sum(8, 7)
  let expected = 15
  if (result !== expected) {
    throw new Error(`${result} is not equal to ${expected}`)
  }

  result = subtract(8, 7)
  expected = 1
  if (result !== expected) {
    throw new Error(`${result} is not equal to ${expected}`)
  }
`

æˆ‘å€‘æœ¬ä¾†æœ‰ bug çš„ - æ”¹æˆ +
å†åŠ ä¸Šæ­£å¸¸ä¾†è¬›çš„ - çš„é‚è¼¯

ç„¶å¾Œå†ç”¨ node å†å»è®€å®ƒä¸€æ¬¡
folder:     cd /Users/terry.yao/project/jest
command:    node js/calculation_fix.js
result:     

æœƒå®Œå…¨æ²’æœ‰åæ‡‰
å› ç‚ºä½ æ²’æœ‰éŒ¯çš„åœ°æ–¹æ‰€ä»¥ä»–æ²’æœ‰ç†ä½ 


ç¾åœ¨å†è·‘ä¸€æ¬¡æŠŠæ¸¬è©¦é‚è¼¯æŠ½å‡ºä¾†
ä½†æ˜¯æŠŠå‰›å‰› calculation æ”¹å›æ­£å¸¸çš„ .js æª”æ¡ˆ
ä½†æ˜¯æˆ‘å€‘æŠŠä¸‹é¢çš„æ¸¬è©¦é‚è¼¯æŠ½èµ°
ç„¶å¾Œå†æŠŠç¾åœ¨çš„ code åš module exports
è®“ä»– sum ä¸€æ¨£ + æ‰“æˆ - é€™æ¨£ç­‰ä¸‹æ‰èƒ½çœ‹æ¸¬è©¦çš„æˆæœ

calculation.js
`
  const sum = (a, b) => a - b // æœ‰ bug
  const subtract = (a, b) => a - b

  module.exports = {
    sum,
    subtract,
  }
`

assertion.js
`
  const { sum, subtract } = require('./calculation')

  let result, expected

  result = sum(8, 7)
  expected = 15
  if (result !== expected) {
    throw new Error(`${result} is not equal to ${expected}`)
  }

  result = subtract(8, 7)
  expected = 1
  if (result !== expected) {
    throw new Error(`${result} is not equal to ${expected}`)
  }
`

ç„¶å¾Œå†ç”¨ node å†å»è®€å®ƒä¸€æ¬¡
folder:     cd /Users/terry.yao/project/jest
command:    node js/assertion.js
result:     
  /Users/terry.yao/project/jest/js/assertion.js:25
        throw new Error(`${result} is not equal to ${expected}`)
        ^

  Error: 1 is not equal to 15
      at Object.toBe (/Users/terry.yao/project/jest/js/assertion.js:25:15)
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/assertion.js:19:16)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47

ç¾åœ¨ä¾†å»ºç«‹ä¸€å€‹ framework.js 
code:
`
function test(title, callback) {
  try {
    callback()
    console.log(`âœ… ${title}`)
  } catch (error) {
    console.error(`âŒ ${title}`)
    console.error(error)
  }
};

module.exports = {
  test,
}
`

é€™è£¡æ˜¯è™•ç†è·³å‡ºè¨Šæ¯ï¼Œè®“éŒ¯èª¤è¨Šæ¯æ›´æ¸…æ¥šä¸€é»

ç„¶å¾Œ assertion.js è£é¢å¼•ç”¨ test function
code:
`
const { sum, subtract } = require('./calculation');
const { test } = require('./framework');

function expect(result) {
  return {
    toBe(expected) {
      if (result !== expected) {
        throw new Error(`${result} is not equal to ${expected}`)
      }
    },
  }
}


test('add numbers', () => {
  const result = sum(8, 7)
  const expected = 15
  expect(result).toBe(expected)
})

test('subtract numbers', () => {
  const result = subtract(8, 7)
  const expected = 1
  expect(result).toBe(expected)
})




module.exports = {
  expect,
}
`

ç„¶å¾Œå†æ¬¡ä½¿ç”¨ node å»æ¸¬ assertion.js
folder:     cd /Users/terry.yao/project/jest
command:    node js/assertion.js
result:     
  âŒ add numbers
  Error: 1 is not equal to 15
      at Object.toBe (/Users/terry.yao/project/jest/js/assertion.js:26:15)
      at /Users/terry.yao/project/jest/js/assertion.js:36:18
      at test (/Users/terry.yao/project/jest/js/framework.js:3:5)
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/assertion.js:33:1)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47
  âœ… subtract numbers


æ¥è‘—æº–å‚™ä¾†æ¸¬è©¦éåŒæ­¥
å–®ç´”æƒ³åšéåŒæ­¥çš„è©±ä¸€é–‹å§‹çš„æ€è·¯ä¸€å®šæ˜¯æƒ³èªªæŠŠ test function æ”¹æˆ async/await é€™æ¨£
assertion.js
code:
`
const { sum, subtract } = require('./calculation');
const { test } = require('./framework');

function expect(result) {
  return {
    toBe(expected) {
      if (result !== expected) {
        throw new Error(`${result} is not equal to ${expected}`)
      }
    },
  }
}

test('add numbers', async () => {
  const result = await sum(8, 7)
  const expected = 15
  expect(result).toBe(expected)
})
test('subtract numbers', async () => {
  const result = await subtract(8, 7)
  const expected = 1
  expect(result).toBe(expected)
})

module.exports = {
  expect,
}
`

æ¥è‘—å†è·‘ä¸€æ¬¡ command
folder:     cd /Users/terry.yao/project/jest
command:    node js/assertion.js
result:     
âœ… add numbers
âœ… subtract numbers
(node:14095) UnhandledPromiseRejectionWarning: ReferenceError: sumAsync is not defined
    at /Users/terry.yao/project/jest/js/assertion.js:34:18
    at test (/Users/terry.yao/project/jest/js/framework.js:3:5)
    at Object.<anonymous> (/Users/terry.yao/project/jest/js/assertion.js:33:1)
    at Module._compile (internal/modules/cjs/loader.js:1158:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
    at Module.load (internal/modules/cjs/loader.js:1002:32)
    at Function.Module._load (internal/modules/cjs/loader.js:901:14)
    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
    at internal/main/run_main_module.js:18:47
(node:14095) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 1)
(node:14095) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
(node:14095) UnhandledPromiseRejectionWarning: ReferenceError: subtractAsync is not defined
    at /Users/terry.yao/project/jest/js/assertion.js:39:18
    at test (/Users/terry.yao/project/jest/js/framework.js:3:5)
    at Object.<anonymous> (/Users/terry.yao/project/jest/js/assertion.js:38:1)
    at Module._compile (internal/modules/cjs/loader.js:1158:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
    at Module.load (internal/modules/cjs/loader.js:1002:32)
    at Function.Module._load (internal/modules/cjs/loader.js:901:14)
    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
    at internal/main/run_main_module.js:18:47
(node:14095) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 2)

åŸ·è¡Œä»¥å¾Œç™¼ç¾æ€éº¼å¯èƒ½è®Šæˆæœƒéï¼Ÿ
é‚„æœ‰ä¸€å€‹å¥‡æ€ªçš„éŒ¯èª¤ UnhandledPromiseRejectionWarning
çœ‹èµ·ä¾†æ˜¯é‡å°æ²’æœ‰è™•ç† promise çš„å„ç¨®ç‹€æ…‹
æ‰€ä»¥ test function ä¹Ÿæ”¹æˆ async function ç„¶å¾Œ await function æ”¹æˆ callback function
framework.js
code:
`
async function test(title, callback) {
  try {
    await callback()
    console.log(`âœ… ${title}`)
  } catch (error) {
    console.error(`âŒ ${title}`)
    console.error(error)
  }
}

module.exports = {
  test,
}
`

å†è·‘ä¸€æ¬¡ command
folder:     cd /Users/terry.yao/project/jest
command:    node js/assertion.js
result:     
  âŒ add numbers
  Error: 1 is not equal to 15
      at Object.toBe (/Users/terry.yao/project/jest/js/assertion.js:26:15)
      at /Users/terry.yao/project/jest/js/assertion.js:48:18
      at async test (/Users/terry.yao/project/jest/js/framework.js:3:5)
  âœ… subtract numbers

å›é ­æŠŠ assertion.js è£é¢åŒäº‹å…¼é¡§åŒæ­¥éåŒæ­¥ä¸€èµ·è·‘çœ‹çœ‹
code:
`
const { sum, subtract } = require('./calculation');
const { test } = require('./framework');

function expect(result) {
  return {
    toBe(expected) {
      if (result !== expected) {
        throw new Error(`${result} is not equal to ${expected}`)
      }
    },
  }
}

// åŒæ­¥å€
test('åŒæ­¥å€ add numbers', () => {
  const result = sum(8, 7)
  const expected = 15
  expect(result).toBe(expected)
})

test('åŒæ­¥å€ subtract numbers', () => {
  const result = subtract(8, 7)
  const expected = 1
  expect(result).toBe(expected)
})

// éåŒæ­¥å€
test('éåŒæ­¥å€ add numbers', async () => {
  const result = await sum(8, 7)
  const expected = 15
  expect(result).toBe(expected)
})
test('éåŒæ­¥å€ subtract numbers', async () => {
  const result = await subtract(8, 7)
  const expected = 1
  expect(result).toBe(expected)
})

module.exports = {
  expect,
}
`

folder:     cd /Users/terry.yao/project/jest
command:    node js/assertion.js
result:     
  âŒ åŒæ­¥å€ add numbers
  Error: 1 is not equal to 15
      at Object.toBe (/Users/terry.yao/project/jest/js/assertion.js:26:15)
      at /Users/terry.yao/project/jest/js/assertion.js:36:18
      at test (/Users/terry.yao/project/jest/js/framework.js:3:11)
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/assertion.js:33:1)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47
  âœ… åŒæ­¥å€ subtract numbers
  âŒ éåŒæ­¥å€ add numbers
  Error: 1 is not equal to 15
      at Object.toBe (/Users/terry.yao/project/jest/js/assertion.js:26:15)
      at /Users/terry.yao/project/jest/js/assertion.js:49:18
      at processTicksAndRejections (internal/process/task_queues.js:97:5)
      at async test (/Users/terry.yao/project/jest/js/framework.js:3:5)
  âœ… éåŒæ­¥å€ subtract numbers

çœ‹èµ·ä¾†å¥½åƒæœ‰é»åƒæ¨£

ç¾åœ¨çœ‹èµ·ä¾†è¦è£œçš„åªæœ‰è®“é€™å€‹ framework.js åšæˆ global ä½¿ç”¨çš„æª”æ¡ˆ
èˆŠçš„æª”æ¡ˆæˆ‘å€‘éƒ½å…ˆä¸è™•ç†
é–‹ä¸€å€‹æ–°çš„ global-framework.js æŠŠ test function è·Ÿ expect function æ”¾é€²å»
code:
`
async function test(title, callback) {
  try {
    await callback();
    console.log(`âœ… ${title}`);
  } catch (error) {
    console.error(`âŒ ${title}`);
    console.error(error);
  }
}

function expect(result) {
  return {
    toBe(expected) {
      if (result !== expected) {
        throw new Error(`${result} is not equal to ${expected}`);
      }
    },
  };
}

global.test = test;
global.expect = expect;
`

ç„¶å¾Œå»ºç«‹ä¸€æ”¯ global-assertion.js æª”æ¡ˆ
code:
`
const { sum, subtract, sumAsync, subtractAsync } = require('./calculation')

test('add numbers', () => {
  const result = sum(8, 7);
  const expected = 15;
  expect(result).toBe(expected);
});
test('subtract numbers', () => {
  const result = subtract(8, 7);
  const expected = 1;
  expect(result).toBe(expected);
});
test('add numbers async', async () => {
  const result = await sumAsync(8, 7);
  const expected = 15;
  expect(result).toBe(expected);
});
test('subtract numbers async', async () => {
  const result = await subtractAsync(8, 7);
  const expected = 1;
  expect(result).toBe(expected);
});
`

æ¥è‘—å°±å¯ä»¥ç¹¼çºŒä½¿ç”¨æ¸¬è©¦äº†
folder:     cd /Users/terry.yao/project/jest
command:    node --require ./js/global-framework.js ./js/global-assertion.js 
result:     
  âŒ add numbers
  Error: 1 is not equal to 15
      at Object.toBe (/Users/terry.yao/project/jest/js/global-framework.js:15:15)
      at /Users/terry.yao/project/jest/js/global-assertion.js:6:18
      at test (/Users/terry.yao/project/jest/js/global-framework.js:3:11)
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/global-assertion.js:3:1)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47
  âœ… subtract numbers
  âŒ add numbers async
  TypeError: sumAsync is not a function
      at /Users/terry.yao/project/jest/js/global-assertion.js:14:24
      at test (/Users/terry.yao/project/jest/js/global-framework.js:3:11)
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/global-assertion.js:13:1)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47
  âŒ subtract numbers async
  TypeError: subtractAsync is not a function
      at /Users/terry.yao/project/jest/js/global-assertion.js:19:24
      at test (/Users/terry.yao/project/jest/js/global-framework.js:3:11)
      at Object.<anonymous> (/Users/terry.yao/project/jest/js/global-assertion.js:18:1)
      at Module._compile (internal/modules/cjs/loader.js:1158:30)
      at Object.Module._extensions..js (internal/modules/cjs/loader.js:1178:10)
      at Module.load (internal/modules/cjs/loader.js:1002:32)
      at Function.Module._load (internal/modules/cjs/loader.js:901:14)
      at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:74:12)
      at internal/main/run_main_module.js:18:47


### node å¾Œé¢åŠ ä¸Š --require æ˜¯æŒ‡åœ¨åŸ·è¡Œä¹‹å‰é å…ˆè¼‰å…¥ç‰¹å®š moduleï¼Œé€™è£¡æŒ‡çš„æ˜¯è¼‰å…¥ global-framework.js

ä¸Šé¢é€™äº›å°±åšå®Œç°¡æ˜“çš„æ¸¬è©¦åˆå§‹æ¨¡çµ„äº†


å¦‚æœæˆ‘å€‘ç…§è‘—ä¸Šé¢é‚£ç¯‡å¯«å¾—ç¹¼çºŒå¾€ä¸‹èµ°
ä»–æœƒå«æˆ‘å€‘è¼¸å…¥ command: npx jest
ä½†æ˜¯è¼¸å…¥ä»¥å¾Œæˆ‘å€‘æœƒå› ç‚ºä¹‹å‰æœ‰å¯«çš„ .test.js æª”æ¡ˆè¢«è®€å–
çœ‹èµ·ä¾†æ ¹æœ¬ä¸çŸ¥é“ç™¼ç”Ÿä»€éº¼äº‹æƒ…

æ¥è‘—åƒè€ƒé€™ç¯‡
https://titangene.github.io/article/jest-build-test-env.html
çœ‹ä¸€ä¸‹ jest æœ‰æ²’æœ‰ä»€éº¼è¨­å®šæˆ‘æ²’æœ‰è¨­å®šåˆ°
ç„¶å¾Œè¨­å®š jest åˆå§‹åŒ– command: npx jest --init
folder:     cd /Users/terry.yao/project/jest
command:    npx jest --init
result:     
  The following questions will help Jest to create a suitable configuration for your project

  âœ” Would you like to use Jest when running "test" script in "package.json"? â€¦ yes
  âœ” Choose the test environment that will be used for testing â€º node
  âœ” Do you want Jest to add coverage reports? â€¦ yes
  âœ” Automatically clear mock calls and instances between every test? â€¦ yes

  âœï¸  Modified /Users/terry.yao/project/jest/package.json

  ğŸ“  Configuration file created at /Users/terry.yao/project/jest/jest.config.js

é€™æ¨£å°±æŠŠ jest.config.js å»ºå‡ºä¾†äº†

å¥½çš„ç„¶å¾Œåœ¨ä»–çš„ day 2 æœ€ä¸‹é¢æ˜¯å»ºç«‹ä¸€å€‹ jest.test.js æª”æ¡ˆï¼Œè£¡é¢æ”¾çš„æ˜¯ global-assertion.js è£é¢çš„ code
ç„¶å¾Œæº–å‚™ç”¨ jest å»è·‘
å› ç‚ºæˆ‘å€‘ç¾åœ¨è£é¢å·²ç¶“æœ‰å¾ˆå¤š test æª”æ¡ˆäº†æ‰€ä»¥ç­‰ä¸‹æœƒé‡å° command åšä¸€äº›èª¿æ•´
ç„¶å¾Œ code çš„éƒ¨åˆ†ä¹Ÿæœƒèª¿æ•´ä¸€äº›æ±è¥¿
global-assertion.js è£é¢çš„ sumAsync/subtractAsync çš„ function æ ¹æœ¬ä¸å­˜åœ¨
æ‰€ä»¥æˆ‘å€‘æŠŠå®ƒæ”¹æˆåŸæœ¬çš„ sum, subtract
code:
`
const { sum, subtract } = require('./calculation')

test('add numbers', () => {
  const result = sum(8, 7);
  const expected = 15;
  expect(result).toBe(expected);
});
test('subtract numbers', () => {
  const result = subtract(8, 7);
  const expected = 1;
  expect(result).toBe(expected);
});
test('add numbers async', async () => {
  const result = await sum(8, 7);
  const expected = 15;
  expect(result).toBe(expected);
});
test('subtract numbers async', async () => {
  const result = await subtract(8, 7);
  const expected = 1;
  expect(result).toBe(expected);
});
`

ç„¶å¾Œå‰›å‰›å»ºå¥½çš„ jest.test.js
code:
`
const { sum, subtract } = require('./calculation')

test('add numbers', () => {
  const result = sum(8, 7);
  const expected = 15;
  expect(result).toBe(expected);
});
test('subtract numbers', () => {
  const result = subtract(8, 7);
  const expected = 1;
  expect(result).toBe(expected);
});
test('add numbers async', async () => {
  const result = await sum(8, 7);
  const expected = 15;
  expect(result).toBe(expected);
});
test('subtract numbers async', async () => {
  const result = await subtract(8, 7);
  const expected = 1;
  expect(result).toBe(expected);
});
`

å¦‚æœæ²’æœ‰æ”¹æˆé€™æ¨£çš„è©±æˆ‘å€‘ç”¨ jest å»è·‘çš„è©±
folder:     cd /Users/terry.yao/project/jest
command:    npm run test ./js/jest.test.js
result:     
  > jstest@1.0.0 test /Users/terry.yao/project/jest
  > jest "./js/jest.test.js"

  FAIL  js/jest.test.js
    âœ• add numbers (5ms)
    âœ“ subtract numbers
    âœ• add numbers async (1ms)
    âœ• subtract numbers async

    â— add numbers

      expect(received).toBe(expected) // Object.is equality

      Expected: 15
      Received: 1

        4 |   const result = sum(8, 7);
        5 |   const expected = 15;
      > 6 |   expect(result).toBe(expected);
          |                  ^
        7 | });
        8 | test('subtract numbers', () => {
        9 |   const result = subtract(8, 7);

        at Object.<anonymous> (js/jest.test.js:6:18)

    â— add numbers async

      TypeError: sumAsync is not a function

        12 | });
        13 | test('add numbers async', async () => {
      > 14 |   const result = await sumAsync(8, 7);
          |                        ^
        15 |   const expected = 15;
        16 |   expect(result).toBe(expected);
        17 | });

        at Object.<anonymous> (js/jest.test.js:14:24)

    â— subtract numbers async

      TypeError: subtractAsync is not a function

        17 | });
        18 | test('subtract numbers async', async () => {
      > 19 |   const result = await subtractAsync(8, 7);
          |                        ^
        20 |   const expected = 1;
        21 |   expect(result).toBe(expected);

å¿«é€Ÿç¿»è­¯çš„æ„æ€å°±æ˜¯é‚£å€‹æ–¹æ³•ä¸å­˜åœ¨

æ”¹éä¹‹å¾Œå†è·‘ä¸€æ¬¡
folder:     cd /Users/terry.yao/project/jest
command:    npm run test ./js/jest.test.js
result:     
  > jstest@1.0.0 test /Users/terry.yao/project/jest
  > jest "./js/jest.test.js"

  FAIL  js/jest.test.js
    âœ• add numbers (4ms)
    âœ“ subtract numbers
    âœ• add numbers async
    âœ“ subtract numbers async

    â— add numbers

      expect(received).toBe(expected) // Object.is equality

      Expected: 15
      Received: 1

        4 |   const result = sum(8, 7);
        5 |   const expected = 15;
      > 6 |   expect(result).toBe(expected);
          |                  ^
        7 | });
        8 | test('subtract numbers', () => {
        9 |   const result = subtract(8, 7);

        at Object.<anonymous> (js/jest.test.js:6:18)

    â— add numbers async

      expect(received).toBe(expected) // Object.is equality

      Expected: 15
      Received: 1

        14 |   const result = await sum(8, 7);
        15 |   const expected = 15;
      > 16 |   expect(result).toBe(expected);
          |                  ^
        17 | });
        18 | test('subtract numbers async', async () => {
        19 |   const result = await subtract(8, 7);

        at Object.<anonymous> (js/jest.test.js:16:18)

  Test Suites: 1 failed, 1 total
  Tests:       2 failed, 2 passed, 4 total
  Snapshots:   0 total
  Time:        0.551s, estimated 1s
  Ran all test suites matching /.\/js\/jest.test.js/i.
  npm ERR! code ELIFECYCLE
  npm ERR! errno 1
  npm ERR! jstest@1.0.0 test: `jest "./js/jest.test.js"`
  npm ERR! Exit status 1
  npm ERR! 
  npm ERR! Failed at the jstest@1.0.0 test script.
  npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

  npm ERR! A complete log of this run can be found in:
  npm ERR!     /Users/terry.yao/.npm/_logs/2021-08-29T03_20_21_345Z-debug.log

åŸºæœ¬ä¸Šé€™æ¨£è·Ÿæˆ‘å€‘æœ¬ä¾†é æœŸçš„æ¸¬è©¦çµæœä¹Ÿæ¯”è¼ƒæ¥è¿‘